---
title: "Laboratorio"
author: "Hugo"
date: "28 de Dezembro de 2019"
output:
  html_document:
    highlight: tango
    theme: united
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: no
      smooth_scroll: no
  pdf_document:
    toc: yes
    toc_depth: '3'
---


```{r}
library(here)
library(data.table)
library(unglue)

data <- fread(here("CancerMortalityEU.csv"), header = TRUE, check.names = TRUE)
pop <- fread(here("PopulationEU.csv"), header = TRUE, check.names = TRUE)


# Colunas certas nos dados
names(data)

cancro <- data[CancerSite %in% "Liver and Intrahepatic Bile Ducts"]


str(cancro)
cancro[, .N, by="CancerSite"] #Pode-se tirar esta coluna
cancro[, .N, by="Cause"] #Pode-se tirar esta coluna mas a ver se não se perde a informação
cancro[, .N, by="ageStart"] #Acho que se pode tirar também
cancro[, .N, by="ageLabel"] #Também acho que se pode tirar se bem que esta pode ser util à frente
cancro[, c("CancerSite", "Cause", "ageStart", "ageLabel"):=NULL]
setnames(cancro, "ageGroup", "Age")


# melt dos dados do cancro

cancer.new <- melt(cancro,
                   id.vars = c("Country","Age"),
                   variable.name = "all",
                   value.name = "Frequencie")

cancer.new[, `:=` (Year=as.numeric(gsub("[^[:digit:].]",
                            "", all)))]

cancer.new[, Sex:=as.character(unglue_vec(all,"{x}_{y}",var="x"))]

cancer.new[, .N, by="Year"]
cancer.new[, .N, by="Sex"]
cancer.new[, all:=NULL]
setcolorder(cancer.new, c("Country","Age","Sex","Year","Frequencie"))

# Criação do EU

cancer.EU <- cancer.new[, .(Country = "European Union", Frequencie = sum(Frequencie, na.rm = TRUE)), by = .(Year, Sex, Age)]
setcolorder(cancer.EU, c("Country","Age","Sex","Year","Frequencie"))
cancer.liver <- rbind(cancer.new,cancer.EU)

# Criação do all

allAge <- cancer.liver[, .(Age = "All", Frequencie = sum(Frequencie)), by = .(Country, Year, Sex)]
setcolorder(allAge, c("Country", "Sex", "Age", "Year", "Frequencie"))
cancer.liver <- rbind(cancer.liver,allAge)

# Selecting the important countries

cancer.liver <- cancer.liver[Country %in% c("Austria", "Cyprus", "Germany", "Malta", "Portugal", "European Union")
                             ][order(Year, Country)]



```
































